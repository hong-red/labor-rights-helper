<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç»´æƒæŒ‡å¼• - ç»´æƒåŠ©æ‰‹</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.0/css/all.min.css">
     
    <style>
        /* ä½ çš„åŸæœ‰ style ä¿æŒä¸å˜ï¼Œè¿™é‡Œåªè¡¥å……å¿…è¦éƒ¨åˆ† */
        .phone-container { margin-top: 16px; }
        .phone-item { 
            padding: 12px 0; 
            border-bottom: 1px solid #eee; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            gap: 12px; 
        }
        .copy-btn {
            background-color: transparent;
            color: #4a90e2; /* ä¸»é¢˜è“è‰² */
            border: 1px solid #4a90e2;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s, color 0.2s;
            flex-shrink: 0; /* é˜²æ­¢æŒ‰é’®è¢«å‹ç¼© */
        }
        .copy-btn:hover {
            background-color: #4a90e2;
            color: white;
        }
        .phone-link { 
            color: #4a90e2; /* ä¸»é¢˜è“è‰² */
            font-weight: bold; 
            text-decoration: none; 
            flex: 1; 
        }
        label {
            display: block;
            margin: 20px 0 8px;
            font-weight: 600;
            color: #2c5282; /* ä¸æ ‡é¢˜é¢œè‰²ä¿æŒä¸€è‡´ */
        }
        .province-search-input {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 12px;
            border: 2px solid #a7c7ed; /* æŸ”å’Œçš„è“è‰²è¾¹æ¡† */
            border-radius: 12px;
            font-size: 1.05rem;
            background: white;
            transition: border-color 0.2s;
        }
        .province-search-input:focus {
            outline: none;
            border-color: #4a90e2; /* èšç„¦æ—¶ä¸»é¢˜è“è‰² */
            box-shadow: 0 0 0 3px rgba(74,144,226,0.2);
        }
        select {
            width: 100%;
            padding: 12px 16px;
            font-size: 1.05rem;
            border: 2px solid #a7c7ed; /* æŸ”å’Œçš„è“è‰²è¾¹æ¡† */
            border-radius: 12px;
            background: white;
            appearance: none; /* ç§»é™¤é»˜è®¤æ ·å¼ */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%234a90e2%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13.2-6.4H18.6c-5%200-9.3%201.8-13.2%206.4-3.9%204.5-6%2010.2-6%2016.3%200%206.1%202.1%2011.8%206%2016.3l118.2%20118.2c4.5%204.5%2010.2%206.4%2016.3%206.4s11.8-1.9%2016.3-6.4l118.2-118.2c3.9-4.5%206-10.2%206-16.3s-2.1-11.8-6-16.3z%22%2F%3E%3C%2Fsvg%3E'); /* è‡ªå®šä¹‰ä¸‹æ‹‰ç®­å¤´ï¼Œé¢œè‰²ä¸ä¸»é¢˜ä¸€è‡´ */
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 12px;
        }
        select:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 3px rgba(74,144,226,0.2);
        }
        /* å…¶ä»–æ ·å¼ï¼Œä¾‹å¦‚ .card, .action-btn, .warning-card ç­‰ï¼Œä¿æŒåŸæœ‰æˆ–æ ¹æ®éœ€è¦è°ƒæ•´ */
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(to bottom, #f0f4f8 0%, #e0e7ed 100%); /* æŸ”å’Œçš„æµ…è“è‰²æ¸å˜ */
            min-height: 100vh;
            color: #333333; /* æ·±ç°è‰²æ–‡æœ¬ */
            line-height: 1.7;
        }
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 16px;
        }
        header {
            text-align: center;
            padding: 40px 0 16px; /* å¢åŠ é¡¶éƒ¨å¡«å……ä»¥é¿å…ä¸è¿”å›æŒ‰é’®é‡å  */
            position: relative;
        }
         .back-button {
             position: absolute;
             left: 16px;
             top: 10px; /* è°ƒæ•´ä½ç½®ï¼Œä½¿å…¶åœ¨å¢åŠ çš„é¡¶éƒ¨å¡«å……å†… */
             font-size: 1.6rem;
             color: #4a90e2; /* ç»Ÿä¸€ä¸ºä¸»é¢˜è“è‰² */
             text-decoration: none;
         }
         h1 {
             font-size: 1.95rem;
             font-weight: 800;
             color: #2c5282; /* æ·±ä¸€ç‚¹çš„ä¸»é¢˜è“è‰² */
             margin: 0;
         }
        main {
            margin: 20px 0 40px;
        }
        .card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .card h2 {
            font-size: 1.3rem;
            color: #2c5282; /* ä¸ä¸»æ ‡é¢˜ä¿æŒä¸€è‡´çš„æ·±è“è‰² */
            margin-bottom: 12px;
            border-bottom: 2px solid #a7c7ed; /* æŸ”å’Œçš„è“è‰²ä¸‹åˆ’çº¿ */
            padding-bottom: 8px;
        }
        .card ul {
            list-style-type: disc;
            margin-left: 20px;
        }
        .card li {
            margin-bottom: 8px;
            color: #555;
        }
        details {
            margin-bottom: 10px;
        }
        details summary {
            font-weight: bold;
            color: #4a90e2; /* ä¸ä¸»é¢˜è“è‰²ä¿æŒä¸€è‡´ */
            cursor: pointer;
            list-style: none; /* éšè—é»˜è®¤ç®­å¤´ */
        }
        details summary::-webkit-details-marker {
            display: none; /* éšè— Chrome/Safari é»˜è®¤ç®­å¤´ */
        }
        details summary:before {
            content: 'â–¶'; /* è‡ªå®šä¹‰ç®­å¤´ */
            margin-right: 8px;
            transition: transform 0.2s;
            display: inline-block;
        }
        details[open] summary:before {
            content: 'â–¼'; /* æ‰“å¼€æ—¶ç®­å¤´å‘ä¸‹ */
            transform: rotate(90deg);
        }
        details p {
            margin-top: 8px;
            color: #555;
            padding-left: 16px;
        }
        .action-btn {
            display: block;
            width: 100%;
            padding: 16px;
            margin-top: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            transition: background-color 0.2s;
        }
        .print-btn {
            background: linear-gradient(135deg, #4a90e2, #2c5282); /* ä¸»é¢˜è“è‰²æ¸å˜ */
        }
        .print-btn:hover {
            background: linear-gradient(135deg, #2c5282, #4a90e2); /* æ‚¬åœæ—¶åè½¬æ¸å˜ */
        }
        .copy-all-btn {
            background: linear-gradient(135deg, #4a90e2, #2c5282); /* ä¸æ‰“å°æŒ‰é’®ä½¿ç”¨ç›¸åŒçš„ä¸»é¢˜è“è‰²æ¸å˜ */
        }
        .copy-all-btn:hover {
            background: linear-gradient(135deg, #2c5282, #4a90e2); /* æ‚¬åœæ—¶åè½¬æ¸å˜ */
        }
        .warning-card {
            background: #e6f7ff; /* æŸ”å’Œçš„æµ…è“è‰²èƒŒæ™¯ */
            border: 1px solid #91d5ff; /* ç•¥æ·±çš„æµ…è“è‰²è¾¹æ¡† */
            color: #2c5282; /* æ·±è“è‰²æ–‡æœ¬ï¼Œä¸æ ‡é¢˜ä¿æŒä¸€è‡´ */
            padding: 16px;
            border-radius: 12px;
            margin: 20px 0;
            font-weight: 500;
        }
        footer {
            text-align: center;
            font-size: 0.85rem;
            color: #555; /* è°ƒæ•´ä¸ºæ›´æŸ”å’Œçš„æ·±ç°è‰² */
            padding: 20px 0;
            border-top: 1px solid #ddd;
        }
        @media (max-width: 480px) {
            h1 { font-size: 1.6rem; }
            .problem-card { font-size: 1.15rem; padding: 18px 14px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-button">â† è¿”å›é¦–é¡µ</a>
            <h1 id="result-title">åŠ è½½ä¸­...</h1>
        </header>
 
        <main id="result-content">
            <label for="province-select">è¯·é€‰æ‹©æ‰€åœ¨çœä»½ï¼ˆå½±å“æœ¬åœ°ç”µè¯/æ´åŠ©åœ°å€ï¼‰ï¼š</label>
            <input type="text" id="province-search" placeholder="æœç´¢çœä»½..." class="province-search-input">
            <select id="province-select"></select>
            <div class="card phone-container">
                <h2>æ‹¨æ‰“ç”µè¯ï¼ˆå…¨å›½ + æœ¬åœ°ï¼‰</h2>
                <div id="phones-list"></div>
            </div>
            <!-- å…¶ä»–å¡ç‰‡ï¼šè¯æ®ã€æ­¥éª¤ã€æé†’ç­‰ -->
        </main>
 
        <footer>
            <!-- ä½ çš„åŸæœ‰ footer -->
            <div class="warning-card">
                <strong>å†œæ°‘å·¥æ¬ è–ªé¦–é€‰ï¼š</strong><br>
                å¾®ä¿¡æœç´¢â€œå›½åŠ¡é™¢å®¢æˆ·ç«¯â€å°ç¨‹åº â†’ â€œæ ¹æ²»æ¬ è–ªâ€ä¸“æ æäº¤çº¿ç´¢<br>
                ï¼ˆå…¨å›½ç»Ÿä¸€ã€äººç¤¾éƒ¨ç£åŠï¼Œæ•ˆç‡æœ€é«˜ï¼‰
            </div>
            <p>ç´§æ€¥æ‹¨æ‰“ï¼š<strong>12348</strong>ï¼ˆæ³•å¾‹æœåŠ¡ï¼‰ / <strong>12333</strong>ï¼ˆäººç¤¾çƒ­çº¿ï¼‰ / <strong>110</strong>ï¼ˆè¯ˆéª—æŠ¥è­¦ï¼‰</p>
            <p>æœ¬å·¥å…·ä»…æ•´ç†å…¬å¼€ä¿¡æ¯ï¼Œä¸æ„æˆæ³•å¾‹æ„è§ã€‚</p>
        </footer>
    </div>
 
    <script src="js/data.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const type = params.get('type');
        const problemKey = params.get('problem');
 
        if (!type || !problemKey || !ç»´æƒæ•°æ®.identities[type] || !ç»´æƒæ•°æ®.identities[type].problems[problemKey]) {
            document.getElementById('result-content').innerHTML = '<p style="text-align:center;color:red;padding:40px;">å‚æ•°é”™è¯¯ï¼Œè¯·è¿”å›é¦–é¡µé‡è¯•</p>';
        } else {
            let userLatitude = null;
            let userLongitude = null;



            const identity = ç»´æƒæ•°æ®.identities[type];
            const problem = identity.problems[problemKey];
    
            document.getElementById('result-title').textContent = `${identity.label} - ${problem.title}`;
    
            const select = document.getElementById('province-select');
            const searchInput = document.getElementById('province-search');
            const phonesList = document.getElementById('phones-list'); // å°† phonesList çš„å®šä¹‰æå‰
    
            function populateProvinceSelect(searchTerm = '') {
                console.log('populateProvinceSelect called with searchTerm:', searchTerm);
                let htmlOptions = '<option value="00">å…¨å›½é€šç”¨ï¼ˆæ¨èï¼‰</option>';
                const filteredProvinces = Object.entries(ç»´æƒæ•°æ®.provinces)
                    .filter(([code, prov]) => code === '00' || prov.name.includes(searchTerm))
                    .sort(([, a], [, b]) => {
                        if (a.name === 'å…¨å›½é€šç”¨') return -1;
                        if (b.name === 'å…¨å›½é€šç”¨') return 1;
                        return a.name.localeCompare(b.name, 'zh-CN');
                    });
    
                filteredProvinces.forEach(([code, prov]) => {
                    if (code !== '00') {
                        htmlOptions += `<option value="${code}">${prov.name}</option>`;
                    }
                });
                select.innerHTML = htmlOptions;
                select.value = localStorage.getItem('lastProvince') || '00';
                renderPhones(); // Call renderPhones after updating the select
            }
    
            populateProvinceSelect(); // Initial population
    
            searchInput.addEventListener('input', (event) => {
                console.log('searchInput input event triggered. Value:', event.target.value);
                populateProvinceSelect(event.target.value);
            });
    
            // æ¸²æŸ“æ ¸å¿ƒå†…å®¹ï¼ˆè¯æ®ã€æ­¥éª¤ã€æé†’ï¼‰
            let coreHtml = '';
            
            // è¯æ®éƒ¨åˆ†
            coreHtml += '<div class="card"><h2>1. æ”¶é›†è¯æ®</h2>';
            problem.evidence.forEach(item => {
                coreHtml += `
                    <details>
                        <summary>${item.name}</summary>
                        <p>${item.tip}</p>
                    </details>`;
            });
            coreHtml += '</div>';
    
            // åç»­è¡ŒåŠ¨
            if (problem.next_steps && problem.next_steps.length > 0) {
                coreHtml += '<div class="card"><h2>2. åç»­è¡ŒåŠ¨å»ºè®®</h2><ul>';
                problem.next_steps.forEach(step => {
                    coreHtml += `<li>${step}</li>`;
                });
                coreHtml += '</ul></div>';
            }
    
            // é‡è¦æé†’
            if (problem.important_tips && problem.important_tips.length > 0) {
                coreHtml += '<div class="card"><h2>3. é‡è¦æé†’</h2><ul>';
                problem.important_tips.forEach(tip => {
                    coreHtml += `<li>${tip}</li>`;
                });
                coreHtml += '</ul></div>';
            }
    
            document.getElementById('result-content').insertAdjacentHTML('beforeend', coreHtml);
    

    
            // ç”µè¯å®æ—¶æ›´æ–°
            function renderPhones() {
                const code = select.value;
                const prov = ç»´æƒæ•°æ®.provinces[code] || ç»´æƒæ•°æ®.provinces['00'] || { phones: {} };
                let pHtml = '';

                const normalizePhone = (phoneStr) => phoneStr.replace(/\D/g, '');

                const commonPhonesSet = new Set(problem.common_phones.map(p => normalizePhone(p)));

                problem.common_phones.forEach(str => {
                    const num = normalizePhone(str);
                    pHtml += `
                        <div class="phone-item">
                            <a href="tel:${num}" class="phone-link">ğŸ“ ${str}</a>
                            ${num ? `<button class="copy-btn" onclick="copyToClip('${num}')">å¤åˆ¶</button>` : ''}
                        </div>`;
                });

                Object.entries(prov.phones || {}).forEach(([name, desc]) => {
                    const num = normalizePhone(desc);
                    if (num && !commonPhonesSet.has(num)) {
                        pHtml += `
                            <div class="phone-item">
                                <a href="tel:${num}" class="phone-link">ğŸ“ ${name}: ${desc}</a>
                                ${num ? `<button class="copy-btn" onclick="copyToClip('${num}')">å¤åˆ¶</button>` : ''}
                            </div>`;
                    }
                });
                phonesList.innerHTML = pHtml;
            }
    
            // åˆå§‹æ¸²æŸ“ç”µè¯
            renderPhones();
    
            // çœä»½åˆ‡æ¢æ›´æ–°ç”µè¯
            select.addEventListener('change', () => {
                console.log('select change event triggered. New value:', select.value);
                localStorage.setItem('lastProvince', select.value);
                renderPhones(); // åªæ›´æ–°ç”µè¯éƒ¨åˆ†ï¼Œä¸åˆ·æ–°é¡µé¢
            });
    
            // å¤åˆ¶åˆ°å‰ªè´´æ¿å‡½æ•°
            function copyToClip(text) {
                navigator.clipboard.writeText(text)
                    .then(() => alert('å·²å¤åˆ¶ç”µè¯å·ç '))
                    .catch(err => console.error('å¤åˆ¶å¤±è´¥:', err));
            }
    
            // æ·»åŠ æ‰“å°å’Œå¤åˆ¶å…¨éƒ¨æŒ‰é’®
            document.getElementById('result-content').insertAdjacentHTML('beforeend', `
                <a href="print.html?type=${type}&problem=${problemKey}" class="action-btn print-btn" target="_blank">
                    ä¸€é”®æ‰“å°è¯æ®æ¸…å•
                </a>
                <button class="action-btn copy-all-btn" onclick="copyAll()">
                    å¤åˆ¶å…¨éƒ¨å†…å®¹åˆ†äº«
                </button>
            `);
    
            // å¤åˆ¶å…¨éƒ¨å†…å®¹å‡½æ•°
            function copyAll() {
                const text = document.getElementById('result-content').innerText;
                navigator.clipboard.writeText(text)
                    .then(() => alert('å·²å¤åˆ¶å…¨éƒ¨å†…å®¹ï¼Œå¯å‘ç»™æœ‹å‹/å¾‹å¸ˆ'))
                    .catch(() => alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶'));
            }








        }
    </script>
 
</body>
</html>